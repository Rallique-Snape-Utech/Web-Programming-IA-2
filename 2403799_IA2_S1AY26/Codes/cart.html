<!-- 
 Name: Rallique Snape
 ID#: 2403799
 Occurance: Friday, 12 - 1:50
 -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body class="main-body">
    <header>
        <div class="header-container">
            <div class="header-title">
                <h1>Snape's Engraving Services</h1>
            </div>
        </div>
    </header>
    <nav>
        <div class="nav-links">
            <a href="product.html">Product page</a>
            <a href="checkout.html">Check Out</a>
            <a href="aboutUs.html">About Us</a>
            <a href="login.html">Logout</a>
        </div>
    </nav>
    <main>
        <div class="cart-section">
            <h2>Shopping Cart</h2>
            <table>
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Image</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Remove</th>
                    </tr>
                </thead>
                <tbody id="cartTable">

                </tbody>
            </table>
            <h3 id="subTotal">Sub Total: $0</h3>
            <h3 id="discount">Discount: 0%</h3>
            <h3 id="tax">Tax: 0%</h3>
            <h3 id="totalprice">Total Price: $0</h3>
        </div>
    </main>
    <footer class="footer">
        <p>&copy; 2025 Snape's Engraving Services. All rights reserved.</p>
    </footer>

    <script>
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        function saveCart() {
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartTotals();
        }

        function updateCartTotals() {
            let subTotal = 0;
            let totalQty = 0;
            cart.forEach(item => {
                subTotal += item.price * item.quantity;
                totalQty += item.quantity;
            });

            let discount = totalQty >= 3 ? subTotal * 0.15 : 0;
            let tax = (subTotal - discount) * 0.15;
            let total = subTotal - discount + tax;

            document.getElementById("subTotal").textContent = `Sub Total: $${subTotal.toFixed(2)}`;
            document.getElementById("discount").textContent = `Discount: $${discount.toFixed(2)}`;
            document.getElementById("tax").textContent = `Tax: $${tax.toFixed(2)}`;
            document.getElementById("totalprice").textContent = `Total Price: $${total.toFixed(2)}`;

            localStorage.setItem("invoice", JSON.stringify({
                subTotal: subTotal.toFixed(2),
                discount: discount.toFixed(2),
                tax: tax.toFixed(2),
                total: total.toFixed(2),
                quantity: totalQty
            }));
        }

        function displayCart() {
            const tbody = document.getElementById("cartTable");
            tbody.innerHTML = "";

            cart.forEach((item, index) => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                <td>${item.name}</td>
                <td><img src="${item.image}" alt="${item.name}" width="100"></td>
                <td>$${item.price.toFixed(2)}</td>
                <td>
                    <button onclick="decreaseQty(${index})">-</button>
                    ${item.quantity}
                    <button onclick="increaseQty(${index})">+</button>
                    </td>
                    <td><button onclick="removeItem(${index})">Remove</button></td>
                    `;
                tbody.appendChild(tr);
            });

            updateCartTotals();
        }

        function increaseQty(index) {
            cart[index].quantity++;
            saveCart();
            displayCart();
        }

        function decreaseQty(index) {
            if (cart[index].quantity > 1) {
                cart[index].quantity--;
            } else {
                cart.splice(index, 1);
            }
            saveCart();
            displayCart();
        }

        function removeItem(index) {
            cart.splice(index, 1);
            saveCart();
            displayCart();
        }

        displayCart();
    </script>
</body>

</html>